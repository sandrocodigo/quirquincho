<div class="flex items-center justify-between py-4">
  <div>
    <h1 class="titulo"> Buscar Producto </h1>
    <p class="text-sm text-gray-500 dark:text-gray-300">Infomacion de Productos</p>
  </div>
  <div class="ml-auto">
    <button (click)="obtenerProductos()" class="ml-1 mr-1" color="primary" mat-mini-fab matTooltip="Actualizar"
      type="button">
      <mat-icon>update</mat-icon>
    </button>
  </div>
</div>

<div class="flex flex-wrap -mx-2">
  <div class="w-full md:w-1/3 px-2">
    @if (buscadorFormGroup) {
      <form [formGroup]="buscadorFormGroup" (ngSubmit)="buscarConCodigoDeBarra()" class="flex-grow" #aForm>
        <div class="flex h-10 items-center px-1 bg-app-bar">
          <div class="flex-grow flex m-0">
            <div class="flex items-center mr-2 px-2 border rounded-full bg-foreground w-full">
              <mat-icon>search</mat-icon>
              <input formControlName="codigoBarra" name="codigoBarra"
                class="w-full px-2 py-3 border-0 outline-none bg-transparent" placeholder="Codigo de Barra...">
            </div>
          </div>
        </div>
      </form>
    }
  </div>
  <div class="w-full md:w-2/3 px-2">
    @if (productoFormGroup) {
      <form (ngSubmit)="onSeleccionar()" [formGroup]="productoFormGroup">
        <ng-select [items]="listaProductos" bindLabel="dato" bindValue="id" appendTo="body" formControlName="productoId"
          name="productoId" #productoSelect placeholder="Buscar producto por codigo o descripcion..."
          panelClass="pos-ngselect">
        </ng-select>
      </form>
    }
  </div>
</div> <br>

<div class="flex flex-wrap -mx-2">
  <div class="w-full md:w-1/2 px-2">
    @if (producto) {
      <div
        class="max-w-md mx-auto bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden p-6 space-y-4 transition-colors duration-300">
        <!-- Código -->
        <div class="flex items-center space-x-2">
          <span class="material-icons text-blue-500">qr_code</span>
          <span class="font-semibold text-sm text-gray-700 dark:text-gray-300">Código:</span>
          <span class="text-gray-900 dark:text-gray-100 font-medium">
            {{ producto.codigo }}
          </span>
        </div>

        <!-- Descripción -->
        <div class="flex items-center space-x-2">
          <span class="material-icons text-green-500">description</span>
          <span class="font-semibold text-sm text-gray-700 dark:text-gray-300">Descripción:</span>
          <span class="text-gray-900 dark:text-gray-100 font-medium">
            {{ producto.descripcion }}
          </span>
        </div>

        <!-- Imágenes -->
        <div class="flex items-start space-x-2">
          <span class="material-icons text-red-500">image</span>
          <div class="flex flex-col">
            <span class="font-semibold text-sm text-gray-700 dark:text-gray-300">Imágenes:</span>
            <div class="flex space-x-2 mt-1">
              @for (foto of producto.fotosUrl; track foto) {
                <img [src]="foto.url" alt="imagen del producto"
                  class="w-16 h-16 object-cover rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm" />
              }
            </div>
          </div>
        </div>

        <!-- Categoría -->
        <div class="flex items-center space-x-2">
          <span class="material-icons text-yellow-500">category</span>
          <span class="font-semibold text-sm text-gray-700 dark:text-gray-300">Categoría:</span>
          <span class="text-gray-900 dark:text-gray-100 font-medium">
            {{ producto.categoria }}
          </span>
        </div>

        <!-- Fabricante -->
        <div class="flex items-center space-x-2">
          <span class="material-icons text-indigo-500">factory</span>
          <span class="font-semibold text-sm text-gray-700 dark:text-gray-300">Fabricante:</span>
          <span class="text-gray-900 dark:text-gray-100 font-medium">
            {{ producto.fabricante }}
          </span>
        </div>

        <!-- Código de barra -->
        <div class="flex items-center space-x-2">
          <span class="material-icons text-purple-500">barcode</span>
          <span class="font-semibold text-sm text-gray-700 dark:text-gray-300">Código de barra:</span>
          <span class="text-gray-900 dark:text-gray-100 font-medium">
            {{ producto.codigoBarra }}
          </span>
        </div>
      </div>
    }
  </div>
  <div class="w-full md:w-1/2 px-2">
    <div class="max-w-3xl mx-auto mt-6">

      <!-- Total saldo -->
      @if (totales) {
        <div class="bg-gray-100 dark:bg-gray-800 mt-4 p-4 rounded-lg shadow-inner text-right">
          <span class="text-sm font-semibold text-gray-700 dark:text-gray-300 mr-2">
            Total de saldo:
          </span>
          <span class="font-bold text-blue-700 dark:text-blue-400 text-3xl">
            {{ totales.cantidadSaldo }}
          </span>
        </div>
      }

      <!-- Precio Venta -->
      <div class="bg-gray-100 dark:bg-gray-800 mt-4 p-4 rounded-lg shadow-inner text-right">
        <span class="text-sm font-semibold text-gray-700 dark:text-gray-300 mr-2">
          Precio Venta:
        </span>
        <span class="font-bold text-green-700 dark:text-green-400 text-3xl">
          Bs. {{ precioVenta | number: '1.2-2' }}
        </span>
      </div>


      <br>
        <h2 class="text-lg font-semibold text-gray-800 dark:text-white mb-4 flex items-center">
          <span class="material-icons mr-2 text-blue-500">inventory_2</span> Ingresos del Producto
        </h2>

        <!-- Lista de ingresos -->
        @for (ingreso of listaIngresos; track $index) {
          <div
            class="bg-white dark:bg-gray-800 shadow-sm rounded-lg p-2 mb-2 border border-gray-200 dark:border-gray-700 flex items-center space-x-4">
            <!-- Detalles -->
            <div class="flex-1 grid grid-cols-4 gap-2 text-sm text-gray-700 dark:text-gray-200">
              <div class="flex flex-col justify-between">
                <span class="text-[10px] text-gray-500 dark:text-gray-400">
                  {{ ingreso.fechaRegistro.toDate() | date:'short' }}
                </span>
                <span class="text-sm font-bold">{{ ingreso.ingresoCodigo }}</span>
              </div>

              <div class="flex flex-col justify-between">
                <span class="text-[10px] text-gray-500 dark:text-gray-400">Sucursal</span>
                <span class="text-sm font-bold">{{ ingreso.sucursal }}</span>
              </div>

              <div class="flex flex-col justify-between">
                <span class="text-[10px] text-gray-500 dark:text-gray-400">Precio</span>
                <span class="text-sm font-bold">
                  {{ ingreso.pv | number: '1.2-2' }}
                </span>
              </div>

              <div class="flex items-center space-x-1">
                <span class="text-xl font-bold text-blue-700 dark:text-blue-400">
                  {{ ingreso.cantidadSaldo }}
                </span>
                <span class="text-gray-600 dark:text-gray-300">
                  &nbsp; de {{ ingreso.cantidad }}
                </span>
              </div>
            </div>
          </div>
        }
      </div>
    </div>
  </div>

  @if (producto) {
    <br>
      <button (click)="barra()" mat-button type="button" color="primary">Codigo de Barra</button>
      <button (click)="imprimir()" mat-button type="button" color="primary">Imprimir</button>
      <br>
      }