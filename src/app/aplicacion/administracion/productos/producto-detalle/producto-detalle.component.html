<div class="flex flex-wrap items-center justify-between gap-3 py-4">
  <h1 class="titulo">Detalle de Producto</h1>
  <button [routerLink]="'/administracion/productos'" class="inline-flex items-center gap-2 !px-4 !py-2" mat-flat-button
    matTooltip="Ir al listado" type="button">
    <mat-icon>list</mat-icon>
    Más Productos
  </button>
</div>

@if (producto) {
<div>
  <div class="max-w-4xl mx-auto p-6 bg-white rounded-lg shadow-lg dark:bg-gray-700">
    <div class="flex flex-wrap items-center -mx-2">
      <!-- Imagen del producto -->
      <div class="w-full sm:w-1/3 px-2 text-center">
        <img
          [src]="producto.fotosUrl && producto.fotosUrl.length> 0 ? producto.fotosUrl[0].url : 'imagenes/sinfoto.png'"
          alt="Imagen del producto" class="w-full h-auto object-cover rounded-lg cursor-pointer"
          (click)="cargarFotos()">
        <div class="mt-3 flex justify-center">
          <button (click)="cargarFotos()" class="inline-flex items-center gap-2 !px-4 !py-2" color="primary"
            mat-flat-button>
            <mat-icon>edit</mat-icon>
            Editar Fotos
          </button>
        </div>
      </div>
      <div class="w-full sm:w-2/3 px-2">
        <!-- Código -->
        <div class="mb-4">
          <p class="italic text-sm text-gray-600 dark:text-gray-300">Código</p>
          <p class="text-xl font-semibold text-gray-900 dark:text-white">{{producto.codigo}}</p>
        </div>
        <!-- Descripción -->
        <div class="mb-4">
          <p class="italic text-sm text-gray-600 dark:text-gray-300">Descripción</p>
          <p class="text-xl font-semibold text-gray-900 dark:text-white">{{producto.descripcion}}</p>
        </div>
        <!-- Código de Barra -->
        <div class="mb-4">
          <p class="italic text-sm text-gray-600 dark:text-gray-300">Código de Barra</p>
          <p class="text-xl font-semibold text-gray-900 dark:text-white">{{producto.codigoBarra}}</p>
        </div>
        <!-- Tipo -->
        <div class="mb-4">
          <p class="italic text-sm text-gray-600 dark:text-gray-300">Tipo</p>
          <p class="text-xl font-semibold text-gray-900 dark:text-white">{{producto.tipo}}</p>
        </div>
        <!-- Categoría -->
        <div class="mb-4">
          <p class="italic text-sm text-gray-600 dark:text-gray-300">Categoría</p>
          <p class="text-xl font-semibold text-gray-900 dark:text-white">{{producto.categoria}}</p>
        </div>
        <!-- Fabricante -->
        <div class="mb-4">
          <p class="italic text-sm text-gray-600 dark:text-gray-300">Fabricante</p>
          <p class="text-xl font-semibold text-gray-900 dark:text-white">{{producto.fabricante}}</p>
        </div>
        <!-- Detalle -->
        <div class="mb-4">
          <p class="italic text-sm text-gray-600 dark:text-gray-300">Detalle</p>
          <div class="text-gray-900 dark:text-white" [innerHTML]="sanitizeHtml(producto.detalle)">
          </div>
          <div class="mt-3 flex justify-start">
            <button (click)="editor()" class="inline-flex items-center gap-2 !px-4 !py-2" color="primary" mat-flat-button>
              <mat-icon>edit</mat-icon>
              Editar detalle
            </button>
          </div>
        </div>
        <!--                 <p>Bound value:</p>
          <p class="e2e-inner-html-interpolated">{{producto.detalle}}</p>
          <p>Result of binding to innerHTML:</p>
          <p class="e2e-inner-html-bound" [innerHTML]="producto.detalle"></p> -->
        <!-- Botones de acción -->
        <div class="flex flex-wrap justify-end gap-2">
          <button (click)="editar()" class="inline-flex items-center gap-2 !px-5 !py-2" color="primary" mat-flat-button>
            <mat-icon>edit</mat-icon>
            Editar Producto
          </button>
        </div>
      </div>
    </div>
  </div>
  <div class="flex flex-wrap justify-center">
    <!-- Imagen Destacada -->
    <div class="w-full p-4 ">
      <div class="bg-white rounded-lg shadow-lg p-4 h-96 flex justify-center items-center dark:bg-gray-700">
        @if (fotoSeleccionado) {
        <img [src]="fotoSeleccionado.url" alt="Imagen destacada" class="object-contain h-full w-full max-w-full">
        }
      </div>
    </div>
    <!-- Miniaturas -->
    <div class="flex space-x-4 p-4 overflow-auto">
      @for (item of fotos; track item) {
      <div cdkDrag class="cursor-pointer">
        <img [src]="item.url" alt="Miniatura"
          class="object-cover h-24 w-24 border-2 border-transparent hover:border-blue-500"
          (click)="seleccionarImagen(item)">
      </div>
      }
    </div>
  </div>
  <div class="flex flex-wrap justify-center">
    <!-- Imagen Destacada -->
    <div class="w-full p-4 ">
      @if (producto.fichaTecnica) {
      <a class="inline-flex items-center gap-2 !px-5 !py-2" mat-flat-button target="_blank"
        [href]="producto.fichaTecnica" [download]="producto.codigo">
        <mat-icon>download</mat-icon>
        Descargar Ficha Técnica
      </a>
      }
    </div>
    <!-- Miniaturas -->
    <div class="flex justify-center space-x-4 p-4">
      <button (click)="seleccionarArchivo()" class="inline-flex items-center gap-2 !px-5 !py-2" color="primary"
        mat-flat-button>
        <mat-icon>upload_file</mat-icon>
        Buscar Ficha Técnica
      </button>
    </div>
  </div>
</div>
}


<div class="space-y-8">
  <div class="bg-white dark:bg-gray-700 shadow-lg rounded-xl border border-gray-100 dark:border-gray-600">
    <div class="flex items-center justify-between border-b border-gray-100 px-6 py-4 dark:border-gray-600">
      <h2 class="text-lg font-semibold text-gray-800 dark:text-white">Kardex La Paz</h2>
      <span class="text-xs font-medium uppercase tracking-wide text-blue-600 dark:text-blue-300">Inventario</span>
    </div>
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200 text-sm dark:divide-gray-600">
        <thead class="bg-gray-50 dark:bg-gray-800">
          <tr>
            <th class="px-4 py-3 text-left font-semibold uppercase tracking-wide text-gray-600 dark:text-gray-300">
              Sucursal
            </th>
            <th class="px-4 py-3 text-left font-semibold uppercase tracking-wide text-gray-600 dark:text-gray-300">
              Fecha
            </th>
            <th class="px-4 py-3 text-left font-semibold uppercase tracking-wide text-gray-600 dark:text-gray-300">
              Tipo
            </th>
            <th class="px-4 py-3 text-left font-semibold uppercase tracking-wide text-gray-600 dark:text-gray-300">
              Motivo
            </th>
            <th class="px-4 py-3 text-left font-semibold uppercase tracking-wide text-gray-600 dark:text-gray-300">
              Cod.
            </th>
            <th class="px-4 py-3 text-right font-semibold uppercase tracking-wide text-gray-600 dark:text-gray-300">
              Cant.
            </th>
            <th class="px-4 py-3 text-right font-semibold uppercase tracking-wide text-gray-600 dark:text-gray-300">
              Acumul.
            </th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100 bg-white dark:divide-gray-700 dark:bg-gray-700">
          @for (item of listaKardexLaPaz; track item; let isLast = $last) {
          <tr class="transition-colors hover:bg-gray-50 dark:hover:bg-gray-800">
            <td class="px-4 py-3 text-gray-800 dark:text-gray-100">{{item.sucursal}}</td>
            <td class="px-4 py-3 text-gray-800 dark:text-gray-100">{{item.fecha | date}}</td>
            <td class="px-4 py-3 font-medium"
              [ngClass]="item.tipo === 'INGRESO'
                ? 'text-emerald-600 dark:text-emerald-400'
                : item.tipo === 'EGRESO'
                  ? 'text-red-600 dark:text-red-400'
                  : 'text-gray-800 dark:text-gray-100'">
              {{item.tipo}}
            </td>
            <td class="px-4 py-3 text-gray-800 dark:text-gray-100">{{item.motivo}}</td>
            <td class="px-4 py-3 text-gray-800 dark:text-gray-100">{{item.codigo}}</td>
            <td class="px-4 py-3 text-right text-gray-800 dark:text-gray-100">{{item.cantidad}}</td>
            <td class="px-4 py-3 text-right text-gray-800 dark:text-gray-100"
              [ngClass]="{ 'text-2xl font-semibold text-blue-600 dark:text-blue-500': isLast }">
              {{item.cantidadAcumulada}}
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
  </div>

  <div class="bg-white dark:bg-gray-700 shadow-lg rounded-xl border border-gray-100 dark:border-gray-600">
    <div class="flex items-center justify-between border-b border-gray-100 px-6 py-4 dark:border-gray-600">
      <h2 class="text-lg font-semibold text-gray-800 dark:text-white">Kardex Santa Cruz</h2>
      <span class="text-xs font-medium uppercase tracking-wide text-blue-600 dark:text-blue-300">Inventario</span>
    </div>
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200 text-sm dark:divide-gray-600">
        <thead class="bg-gray-50 dark:bg-gray-800">
          <tr>
            <th class="px-4 py-3 text-left font-semibold uppercase tracking-wide text-gray-600 dark:text-gray-300">
              Sucursal
            </th>
            <th class="px-4 py-3 text-left font-semibold uppercase tracking-wide text-gray-600 dark:text-gray-300">
              Fecha
            </th>
            <th class="px-4 py-3 text-left font-semibold uppercase tracking-wide text-gray-600 dark:text-gray-300">
              Tipo
            </th>
            <th class="px-4 py-3 text-left font-semibold uppercase tracking-wide text-gray-600 dark:text-gray-300">
              Motivo
            </th>
            <th class="px-4 py-3 text-left font-semibold uppercase tracking-wide text-gray-600 dark:text-gray-300">
              Cod.
            </th>
            <th class="px-4 py-3 text-right font-semibold uppercase tracking-wide text-gray-600 dark:text-gray-300">
              Cant.
            </th>
            <th class="px-4 py-3 text-right font-semibold uppercase tracking-wide text-gray-600 dark:text-gray-300">
              Acumul.
            </th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100 bg-white dark:divide-gray-700 dark:bg-gray-700">
          @for (item of listaKardexSantaCruz; track item; let isLast = $last) {
          <tr class="transition-colors hover:bg-gray-50 dark:hover:bg-gray-800">
            <td class="px-4 py-3 text-gray-800 dark:text-gray-100">{{item.sucursal}}</td>
            <td class="px-4 py-3 text-gray-800 dark:text-gray-100">{{item.fecha | date}}</td>
            <td class="px-4 py-3 font-medium"
              [ngClass]="item.tipo === 'INGRESO'
                ? 'text-emerald-600 dark:text-emerald-400'
                : item.tipo === 'EGRESO'
                  ? 'text-red-600 dark:text-red-400'
                  : 'text-gray-800 dark:text-gray-100'">
              {{item.tipo}}
            </td>
            <td class="px-4 py-3 text-gray-800 dark:text-gray-100">{{item.motivo}}</td>
            <td class="px-4 py-3 text-gray-800 dark:text-gray-100">{{item.codigo}}</td>
            <td class="px-4 py-3 text-right text-gray-800 dark:text-gray-100">{{item.cantidad}}</td>
            <td class="px-4 py-3 text-right text-gray-800 dark:text-gray-100"
              [ngClass]="{ 'text-2xl font-semibold text-blue-600 dark:text-blue-300': isLast }">
              {{item.cantidadAcumulada}}
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
  </div>

  <div class="bg-white dark:bg-gray-700 shadow-lg rounded-xl border border-gray-100 dark:border-gray-600">
    <div class="flex items-center justify-between border-b border-gray-100 px-6 py-4 dark:border-gray-600">
      <h2 class="text-lg font-semibold text-gray-800 dark:text-white">Kardex Cochabamba</h2>
      <span class="text-xs font-medium uppercase tracking-wide text-blue-600 dark:text-blue-300">Inventario</span>
    </div>
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200 text-sm dark:divide-gray-600">
        <thead class="bg-gray-50 dark:bg-gray-800">
          <tr>
            <th class="px-4 py-3 text-left font-semibold uppercase tracking-wide text-gray-600 dark:text-gray-300">
              Sucursal
            </th>
            <th class="px-4 py-3 text-left font-semibold uppercase tracking-wide text-gray-600 dark:text-gray-300">
              Fecha
            </th>
            <th class="px-4 py-3 text-left font-semibold uppercase tracking-wide text-gray-600 dark:text-gray-300">
              Tipo
            </th>
            <th class="px-4 py-3 text-left font-semibold uppercase tracking-wide text-gray-600 dark:text-gray-300">
              Motivo
            </th>
            <th class="px-4 py-3 text-left font-semibold uppercase tracking-wide text-gray-600 dark:text-gray-300">
              Cod.
            </th>
            <th class="px-4 py-3 text-right font-semibold uppercase tracking-wide text-gray-600 dark:text-gray-300">
              Cant.
            </th>
            <th class="px-4 py-3 text-right font-semibold uppercase tracking-wide text-gray-600 dark:text-gray-300">
              Acumul.
            </th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100 bg-white dark:divide-gray-700 dark:bg-gray-700">
          @for (item of listaKardexCochabamba; track item; let isLast = $last) {
          <tr class="transition-colors hover:bg-gray-50 dark:hover:bg-gray-800">
            <td class="px-4 py-3 text-gray-800 dark:text-gray-100">{{item.sucursal}}</td>
            <td class="px-4 py-3 text-gray-800 dark:text-gray-100">{{item.fecha | date}}</td>
            <td class="px-4 py-3 font-medium"
              [ngClass]="item.tipo === 'INGRESO'
                ? 'text-emerald-600 dark:text-emerald-400'
                : item.tipo === 'EGRESO'
                  ? 'text-red-600 dark:text-red-400'
                  : 'text-gray-800 dark:text-gray-100'">
              {{item.tipo}}
            </td>
            <td class="px-4 py-3 text-gray-800 dark:text-gray-100">{{item.motivo}}</td>
            <td class="px-4 py-3 text-gray-800 dark:text-gray-100">{{item.codigo}}</td>
            <td class="px-4 py-3 text-right text-gray-800 dark:text-gray-100">{{item.cantidad}}</td>
            <td class="px-4 py-3 text-right text-gray-800 dark:text-gray-100"
              [ngClass]="{ 'text-2xl font-semibold text-blue-600 dark:text-blue-300': isLast }">
              {{item.cantidadAcumulada}}
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
</div>
